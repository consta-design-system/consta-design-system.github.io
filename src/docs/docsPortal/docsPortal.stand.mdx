import { MdxMenu } from '@consta/stand';

Документация дизайн-системы работает на кастомном движке, который разработала и поддерживает команда Consta.

Портал с документацией объединяет все библиотеки Consta. Библиотеки находятся в разных репозиториях, в каждом репозитории — своя документация. Портал автоматически собирает страницу со списком библиотек и показывает все библиотеки на одном сайте — на одном домене и под общей шапкой.

##### Преимущества движка

- Сборка документации из разных репозиториев в один веб-документ, с общей навигацией и оформлением.
- Кастомная витрина для демонстрации компонентов, с разными вариантами представления и просмотра (десктоп, планшет, телефон).
- Песочница Sandbox.
- Статусы компонентов (можно добавить любые).
- Поиск по компонентам с фильтрами для статусов (`Deprecated`, `Canary`), адаптированный к нашим процессам разработки.
- Кастомные вкладки в статьях.

<MdxMenu>

- [Портал](#портал)
  - [Список библиотек](#список-библиотек)
  - [Левое меню](#левое-меню)
- [Библиотеки](#библиотеки)

</MdxMenu>

## Портал

- [Адрес портала](##HOME)
- [Репозиторий](https://github.com/consta-design-system/portal)

Портал — это рамка для всех библиотек.

Что есть на портале:

- Левое меню
- [Главная страница](/) — со списком разделов и библиотек
- [Статьи и гайды](##LIBS.LIB.STAND/lib:portal/stand:startwork-faq) по дизайн-системе

### Список библиотек

Список библиотек собирается из всех репозиториев дизайн-системы на [главной странице](##LIBS) портала.

Библиотеки нужно добавлять в список вручную. Контент для конкретной библиотеки обновляется в самой библиотеке.

#### Как обновить список библиотек

##### Шаг 1. Обновите конфиг стенда в библиотеке

В репозитории библиотеки, которую нужно обновить или добавить на страницу, заполните конфигурационный файл стенда `stand/standConfig.ts` и выложите в продакшен в основную ветку (обычно это `master`).

##### Шаг 2. Добавьте репозиторий библиотеки

Добавьте репозиторий и ветку, из которой нужно взять данные для библиотеки, в список [clone-repositories.sh](https://github.com/consta-design-system/portal/blob/master/clone-repositories.sh)

Например, так:

```tsx
git clone -b master https://${REPO_ACCESS_TOKEN}@github.com/consta-design-system/uikit.git ./repositories/uikit`
```

##### Шаг 3. Добавьте алиас библиотеки

Добавьте алиас библиотеки в [webpack.config.js](https://github.com/consta-design-system/portal/blob/master/webpack.config.js) в объект `repos`:

```tsx
const repos = [
  'analytic-ui',
  'uikit',
  'charts',
  'header',
  'stats',
  'react-big-calendar-adapter',
  'gantt-task-react-adapter',
  'rc-tree-adapter',
  'rc-table-adapter',
  'ag-grid-adapter',
  'widgets',
  'amcharts-map-examples',
  'gpn-responses',
  'icons',
];
```

Это нужно для работы абсолютных путей через `##`.

Например, конструкция `##/utils/bem` в репозитории `@consta/uikit` обрабатывается как `/repositories/uikit/utils/bem`, а в `@consta/header` — как `/repositories/header/utils/bem`.

##### Шаг 4. Соберите портал

```
# клонируйте репозитории
yarn clone-repos

# копируйте зависимости репозиториев в проект (если нужно)
yarn copy-deps

# установите зависимости
yarn install

# запустите стенд
yarn start
```

### Левое меню

Левое меню собирается автоматически из всех статей в проекте.

Чтобы добавить статью в левое меню, нужно:

##### Шаг 1. Добавить новую группу статей

Добавьте группу для статьи в настройки библиотеки `src/stand/standConfig.ts` в объект `groups`.

Например, так:

```tsx
groups: [
  {
    title: 'О дизайн-системе',
    id: 'about',
  },
];
```

##### Шаг 2. Указать, что статья относится к этой группе

В настройках статьи (`src/<Название статьи>/<Название статьи>.stand.mdx`), в параметре `group` укажите идентификатор этой группы:

```tsx
export default createStand({
  title: 'О дизайн-системе', //заголовок страницы
  id: 'aboutConsta', //идентификатор, отображается в url
  group: 'about', //группа в меню
  order: 10, //порядок в группе
  visibleOnHeader: true, //показывать в верхнем меню
});
```

## Библиотеки

Все библиотеки устроены одинаково: внутри есть статьи, у каждой статьи есть свои настройки, статьи собираются на странице **Обзор** (`<адрес портала>` + `libs`). [Посмотреть список библиотек](/)

Левое меню собирается и настраивается так же, [как на портале](#левое-меню).

### Настройки библиотеки

Конфигурационный файл библиотеки: `src/stand/standConfig.ts`.

```tsx
import { createConfig } from '@consta/stand';

import image from './ConstaImage.png';
import description from './description.mdx';
import { StandPageDecoration as standPageDecoration } from './standPageDecoration';

export const { createStand } = createConfig({
  title: 'Consta UI Kit',
  id: 'uikit',
  groups: [
    {
      title: 'Документация',
      id: 'about',
    },
    {
      title: 'Компоненты',
      id: 'components',
      view: 'card',
    },
  ],
  group: 'Библиотеки', // группа в списке библиотек на портале
  image, // изображение на главной странице библиотеки
  description, // описание на главной странице библиотеки
  standPageDecoration, // темы
  repositoryUrl: 'https://github.com/consta-design-system/uikit', // репозиторий библиотеки на GitHub
  order: 1, // порядок в группе на портале
});
```
